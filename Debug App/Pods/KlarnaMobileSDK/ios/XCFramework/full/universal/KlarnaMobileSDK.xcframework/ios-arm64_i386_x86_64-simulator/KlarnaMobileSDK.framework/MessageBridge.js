(()=>{"use strict";var e={935:(e,s,a)=>{s.__esModule=!0;var n=a(242),t=a(442),r=a(26),o=a(857),i=a(74),l=a(356),d=a(933),g=a(995),c=a(887),u=a(179),p=a(959),v=a(327),f=function(){function e(){this.nativeReady=!1,this.klarnaPaymentsReady=!1,this.receivers=[],this.queuedMessages=[],this.queuedKlarnaPaymentsMessages=[],this.version="v1.2.2-fefac81f31e",this.eventListeners=[],this.handshakeResponseParamsMap={},this.base64Controller=new c.Base64ControllerImpl,this.messageController=new u.MessageControllerImpl,this.base64Controller.overrideDefaults()}return e.prototype.addReceiver=function(e,s){try{var a=new n.MessageReceiverImpl(e,s);this.nativeReady&&(this.messageController.postEventMessageToNative(new t.BridgeMessageImpl(l.BridgeMessageAction.ReceiverAdded,a.name,null,null)),a.registeredNatively=!0),this.receivers.push(a),this.notifyEvent({name:"AddedReceiver",payload:{name:e}})}catch(s){g.Logger.default.error("MessageBridge.addReceiver failed.",s),this.notifyEvent({name:"AddReceiverFailed",payload:{name:e,error:s.toString()}})}},e.prototype.removeReceiver=function(e,s){try{this.receivers=this.receivers.filter((function(a){return a.name!==e&&a.callback!==s})),this.nativeReady&&this.messageController.postEventMessageToNative(new t.BridgeMessageImpl(l.BridgeMessageAction.ReceiverRemoved,e,null,null)),this.notifyEvent({name:"RemovedReceiver",payload:{name:e}})}catch(s){g.Logger.default.error("MessageBridge.removeReceiver failed.",s),this.notifyEvent({name:"RemoveReceiverFailed",payload:{name:e,error:s.toString()}})}},e.prototype.postMessage=function(e,s){void 0===s&&(s=!1);try{"Native"===e.sender&&e.receiver===p.KlarnaProductNames.KlarnaPaymentsWrapper&&e.action!==v.ClientMessageActions.handshakeResponse&&!1===this.klarnaPaymentsReady?this.queuedKlarnaPaymentsMessages.push(e):(this.messageController.postMessage(this,e,s),"Native"===e.sender&&e.receiver===p.KlarnaProductNames.KlarnaPayments&&e.action===v.ClientMessageActions.handshakeResponse&&!1===this.klarnaPaymentsReady&&setTimeout(this.setKlarnaPaymentsReady.bind(this)))}catch(s){g.Logger.default.error("MessageBridge.postMessage failed.",s),this.notifyEvent({name:"PostMessageFailed",payload:{action:e.action,sender:e.sender,receiver:e.receiver,error:s.toString()}})}},e.prototype.setNativeReady=function(){try{if(this.nativeReady)this.messageController.postEventMessageToNative(new t.BridgeMessageImpl(l.BridgeMessageAction.MessageBridgeAlreadyRunning,null,null,null)),this.notifyEvent({name:"NativeHookAlreadyReady",payload:{receivers:this.receivers.toString(),queuedMessages:this.queuedMessages.toString()}});else{this.nativeReady=!0,this.messageController.postEventMessageToNative(new t.BridgeMessageImpl(l.BridgeMessageAction.MessageBridgeWillStart,null,null,null));for(var e=0,s=this.receivers.filter((function(e){return!e.registeredNatively}));e<s.length;e++){var a=s[e];this.messageController.postEventMessageToNative(new t.BridgeMessageImpl(l.BridgeMessageAction.ReceiverAdded,a.name,null,null)),a.registeredNatively=!0}for(var n=0,r=this.queuedMessages;n<r.length;n++){var o=r[n];this.messageController.postEventMessageToNative(new t.BridgeMessageImpl(l.BridgeMessageAction.MessagePosted,null,o,null))}this.queuedMessages=[],this.notifyEvent({name:"NativeHookReady",payload:{receivers:this.receivers.toString(),queuedMessages:this.queuedMessages.toString()}})}this.reportEndpoints()}catch(e){g.Logger.default.error("MessageBridge.setNativeReady failed.",e),this.notifyEvent({name:"NativeHookSetNativeReadyFailed",payload:{receivers:this.receivers.toString(),queuedMessages:this.queuedMessages.toString(),error:e.toString()}})}},e.prototype.setKlarnaPaymentsReady=function(){this.klarnaPaymentsReady=!0;for(var e=0,s=this.queuedKlarnaPaymentsMessages;e<s.length;e++){var a=s[e];this.messageController.postMessage(this,a,!0)}this.queuedKlarnaPaymentsMessages=[]},e.prototype.inSdkWebView=function(){try{return null!=d.getNativeMessageHandler()}catch(e){return g.Logger.default.error("MessageBridge.inSdkWebView failed.",e),!1}},e.prototype.addEventListener=function(e){this.eventListeners.indexOf(e)<=-1&&this.eventListeners.push(e)},e.prototype.removeEventListener=function(e){this.eventListeners=this.eventListeners.filter((function(s){return s!=e}))},e.prototype.notifyEvent=function(e){this.eventListeners.forEach((function(s){return s(e)}))},e.prototype.compareVersion=function(e,s){try{return d.compareVersion(e,s)}catch(e){return g.Logger.default.error("MessageBridge.compareVersion failed.",e),0}},e.prototype.reportEndpoints=function(){var e=new r.BridgeDataImpl(this.version,new o.EndpointDataImpl(i.Endpoints.Analytics.Staging,i.Endpoints.Analytics.Production),new o.EndpointDataImpl(i.Endpoints.DeviceData.Staging,i.Endpoints.DeviceData.Production));this.messageController.postEventMessageToNative(new t.BridgeMessageImpl(l.BridgeMessageAction.EndpointsReported,null,null,e))},e}();s.MessageBridgeImpl=f},887:(e,s,a)=>{s.__esModule=!0;var n=a(995),t=a(79),r=function(){function e(){}return e.prototype.overrideDefaults=function(){if(null==window.defaultAtob||null==window.sdkAtob){var e=window.atob,s=function(s){return 0===s.indexOf(t.KlarnaUtf8Base64Prefix)?function(s){try{return decodeURIComponent(atob(s).split("").map((function(e){var s;return null===(s=e.charCodeAt(0).toString(16).match(/.{1,2}/g))||void 0===s?void 0:s.map((function(e){return"%"+("00"+e).slice(-2)})).join("")})).join(""))}catch(a){n.Logger.default.error("atob-custom",{"src-string":s,msg:a.toString()});try{return e(s)}catch(e){throw n.Logger.default.error("atob-default",{"src-string":s,msg:e.toString()}),e}}}(s.substr(t.KlarnaUtf8Base64Prefix.length)):e(s)};window.atob=s,window.defaultAtob=e,window.sdkAtob=s}else n.Logger.default.debug("Already installed custom atob(). Skipping.")},e}();s.Base64ControllerImpl=r},179:(e,s,a)=>{s.__esModule=!0;var n=a(995),t=a(791),r=a(593),o=a(621),i=a(749),l=a(779),d=a(218),g=a(777),c=a(299),u=function(){function e(){this.nativeMessageSender=new t.NativeMessageSender,this.componentMessageSender=new r.ComponentMessageSender,this.messageProcessors=[new o.HandshakeResponseActionMessageProcessor,new i.StringifiedProductOptionsMessageProcessor,new l.SetExperimentsFormatMessageProcessor,new d.PaymentsWrapperExtractBase64MessageProcessor,new g.SessionDataBase64MessageProcessor,new c.FullscreenShowCanScrollMessageProcessor]}return e.prototype.postMessage=function(e,s,a){if(this.messageProcessors.forEach((function(n,t){n.processMessage(e,s,a)})),"handshakeResponse"===s.action)try{e.handshakeResponseParamsMap[s.receiver]=s.params}catch(e){var t="Error caching handshake response params: ";try{t+=JSON.stringify(e)}catch(e){}finally{n.Logger.default.error("cache-handshakeResponseParams",{msg:t})}}this.postComponentMessage(e,s),a||this.postNativeMessage(e,s)},e.prototype.postEventMessageToNative=function(e){t.NativeMessageSender.postEventMessageToNative(e)},e.prototype.postComponentMessage=function(e,s){this.componentMessageSender.sendMessage(e,s)},e.prototype.postNativeMessage=function(e,s){this.nativeMessageSender.sendMessage(e,s)},e}();s.MessageControllerImpl=u},299:(e,s,a)=>{s.__esModule=!0;var n=a(933),t=function(){function e(){}return e.prototype.processMessage=function(e,s,a){var n;"fullscreenShow"===s.action&&("android"===(null===(n=this.getHandshakeResponseParams(e,s,a))||void 0===n?void 0:n.osName)&&(s.params.canScroll="true"))},e.prototype.getHandshakeResponseParams=function(e,s,a){return void 0===a&&(a=!1),a?n.getHandshakeResponseParams(e,s.receiver):n.getHandshakeResponseParams(e,s.sender)},e}();s.FullscreenShowCanScrollMessageProcessor=t},621:(e,s)=>{s.__esModule=!0;var a=function(){function e(){}return e.prototype.processMessage=function(e,s,a){"handhakeResponse"===s.action&&(s.action="handshakeResponse")},e}();s.HandshakeResponseActionMessageProcessor=a},218:(e,s,a)=>{s.__esModule=!0;var n=a(995),t=function(){function e(){}return e.prototype.processMessage=function(e,s,a){"handshake"===s.action&&"KlarnaPaymentsWrapper"===s.sender&&window.__WrapperMessageController&&window.__WrapperMessageController._extractBase64&&(window.__WrapperMessageController._extractBase64=function(e,s,a){if(null==e.params[a]||"null"===e.params[a])return null;try{var t=e.params[a],r=atob(t);return JSON.parse(r)}catch(e){n.Logger.default.error("extract-b64",{msg:"Error extracting b64 with custom atob() "+JSON.stringify(e)})}})},e}();s.PaymentsWrapperExtractBase64MessageProcessor=t},777:(e,s,a)=>{s.__esModule=!0;var n=a(79),t=a(995),r=function(){function e(){}return e.prototype.processMessage=function(e,s,a){if("actionToComponent"===s.action)try{if("undefined"!==s.params.sessionData&&null!=s.params.sessionData)if("null"===s.params.sessionData)delete s.params.sessionData;else{var r=s.params.sessionData;s.params.sessionData=n.KlarnaUtf8Base64Prefix+r.replace(/\n/g,"").replace(/-/g,"+").replace(/_/g,"/")}}catch(e){t.Logger.default.error("re-format-session-data",{msg:"Error reformatting session data: "+JSON.stringify(e)})}},e}();s.SessionDataBase64MessageProcessor=r},779:(e,s,a)=>{s.__esModule=!0;var n=a(995),t=function(){function e(){}return e.prototype.processMessage=function(e,s,a){if("setExperiments"===s.action)try{if(void 0!==s.params.experiments&&"undefined"!==s.params.experiments&&null!=s.params.experiments){var t=s.params.experiments;"string"!=typeof t&&(s.params.experiments=JSON.stringify(t))}}catch(e){n.Logger.default.error("rewrite-experiments",{msg:"Error stringifying experiments parameter sent from KP: "+JSON.stringify(e)})}},e}();s.SetExperimentsFormatMessageProcessor=t},749:(e,s,a)=>{s.__esModule=!0;var n=a(714),t=a(995),r=function(){function e(){}return e.prototype.processMessage=function(e,s,a){if("handshakeResponse"===s.action)try{for(var r=s.params.osName,o=s.params.nativeVersion,i=0,l=n.StringifiedKlarnaInitDataSdks;i<l.length;i++){var d=l[i];if(r===d.osName&&o===d.nativeVersion){var g=s.params.productOptions;if(void 0!==g&&"undefined"!==g&&null!=g){var c=JSON.parse(g);if(null!=c&&null!=c.klarnaInitData)try{var u=JSON.parse(c.klarnaInitData);c.klarnaInitData=u,s.params.productOptions=JSON.stringify(c)}catch(e){var p="Error parsing klarnaInitData parameter inside productOptions: ";try{p+=JSON.stringify(e)}catch(e){}finally{t.Logger.default.error("rewrite-productOptions",{msg:p})}}}}}}catch(e){p="Error parsing productOptions parameter: ";try{p+=JSON.stringify(e)}catch(e){}finally{t.Logger.default.error("rewrite-productOptions",{msg:p})}}},e}();s.StringifiedProductOptionsMessageProcessor=r},593:(e,s)=>{s.__esModule=!0;var a=function(){function e(){}return e.prototype.sendMessage=function(e,s){for(var a=0,n=e.receivers;a<n.length;a++){var t=n[a];t.name!==s.receiver&&"*"!==s.receiver||t.callback(s)}},e}();s.ComponentMessageSender=a},791:(e,s,a)=>{s.__esModule=!0;var n=a(149),t=a(442),r=a(356),o=a(933),i=a(618),l=function(){function e(){this.delayedMessages=[],this.sendDelayedMessagesWithInterval()}return e.prototype.sendMessage=function(s,a){s.nativeReady?e.shouldDelayMessage(s,a)?this.delayedMessages.push(a):e.postEventMessageToNative(new t.BridgeMessageImpl(r.BridgeMessageAction.MessagePosted,null,a,null)):s.queuedMessages.push(a)},e.prototype.sendDelayedMessagesWithInterval=function(){var s=this;window.setInterval((function(){var a=s.delayedMessages.shift();null!=a&&e.postEventMessageToNative(new t.BridgeMessageImpl(r.BridgeMessageAction.MessagePosted,null,a,null))}),200)},e.postEventMessageToNative=function(e){var s=o.getNativeMessageHandler();null!=s&&s.postMessage(JSON.stringify(e))},e.shouldDelayMessage=function(e,s){if(-1!==n.ClientFullscreenActions.indexOf(s.action)){var a=o.getHandshakeResponseParams(e,s.sender);if(a)for(var t=a.osName,r=a.merchantAppName,l=0,d=i.DelayedFullscreenMerchants;l<d.length;l++){var g=d[l];if(t===g.osName&&r===g.merchantAppName)return!0}}return!1},e}();s.NativeMessageSender=l},995:(e,s)=>{var a;s.__esModule=!0,function(e){e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warn=2]="Warn",e[e.Error=3]="Error",e[e.None=4]="None"}(a=s.LogLevel||(s.LogLevel={}));var n=function(){function e(){this.level=a.None,this.delegate=null}return e.prototype.debug=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];this.level===a.Debug&&(null!=this.delegate&&this.delegate.logDebug(this._stringifyParams(e)),console.log.apply(console,e))},e.prototype.info=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];this.level<=a.Info&&(null!=this.delegate&&this.delegate.logDebug(this._stringifyParams(e)),console.info.apply(console,e))},e.prototype.warn=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];this.level<=a.Warn&&(null!=this.delegate&&this.delegate.logDebug(this._stringifyParams(e)),console.warn.apply(console,e))},e.prototype.error=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];this.level<=a.Error&&(null!=this.delegate&&this.delegate.logError(this._stringifyParams(e)),console.error.apply(console,e))},e.prototype._stringifyParams=function(e){try{return JSON.stringify(e,null,2)}catch(e){return"Couldn't stringify logging params."}},e.default=new e,e}();s.Logger=n},933:(e,s)=>{s.__esModule=!0,s.getNativeMessageHandler=function(){var e;return window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.KlarnaNativeHookMessageHandler?e=window.webkit.messageHandlers.KlarnaNativeHookMessageHandler:window.KlarnaNativeHookMessageHandler&&(e=window.KlarnaNativeHookMessageHandler),e},s.getHandshakeResponseParams=function(e,s){return e.handshakeResponseParamsMap[s]},s.compareVersion=function(e,s){for(var a=e.split("-")[0].replace("v","").split(".").map((function(e){var s=parseInt(e,10);return isNaN(s)?0:s}));a.length<3;)a.push(0);for(var n=s.split("-")[0].replace("v","").split(".").map((function(e){var s=parseInt(e,10);return isNaN(s)?0:s}));n.length<3;)n.push(0);return a[0]>n[0]?1:a[0]<n[0]?-1:a[1]>n[1]?1:a[1]<n[1]?-1:a[2]>n[2]?1:a[2]<n[2]?-1:0}},356:(e,s)=>{s.__esModule=!0,function(e){e.ReceiverAdded="ReceiverAdded",e.ReceiverRemoved="ReceiverRemoved",e.MessagePosted="MessagePosted",e.EndpointsReported="EndpointsReported",e.MessageBridgeWillStart="MessageBridgeWillStart",e.MessageBridgeAlreadyRunning="MessageBridgeAlreadyRunning"}(s.BridgeMessageAction||(s.BridgeMessageAction={}))},149:(e,s,a)=>{s.__esModule=!0;var n=a(327);s.ClientFullscreenActions=[n.ClientMessageActions.fullscreenReplaceWebView,n.ClientMessageActions.fullscreenMoveWebView,n.ClientMessageActions.fullscreenReplaceOverlay,n.ClientMessageActions.fullscreenRestoreWebView]},327:(e,s)=>{s.__esModule=!0,function(e){e.fullscreenReplaceWebView="fullscreenReplaceWebView",e.fullscreenMoveWebView="fullscreenMoveWebView",e.fullscreenReplaceOverlay="fullscreenReplaceOverlay",e.fullscreenRestoreWebView="fullscreenRestoreWebView",e.handshakeResponse="handshakeResponse",e.actionToComponent="actionToComponent"}(s.ClientMessageActions||(s.ClientMessageActions={}))},618:(e,s)=>{s.__esModule=!0,s.DelayedFullscreenMerchants=[{merchantAppName:"boohooMAN",osName:"iOS"},{merchantAppName:"Nasty Gal",osName:"iOS"},{merchantAppName:"MISSPAP",osName:"iOS"},{merchantAppName:"boohoo",osName:"iOS"},{merchantAppName:"PLT UAT",osName:"iOS"}]},74:(e,s)=>{s.__esModule=!0,s.Endpoints={Analytics:{Staging:"evt-eu.staging.eu1.yaco.klarna.net",Production:"not-reallly-evt.klarna.com"},DeviceData:{Staging:"devicedata-staging.klarna",Production:"devicedata-production.klarna"}}},959:(e,s)=>{s.__esModule=!0,function(e){e.KlarnaPayments="KlarnaPayments",e.KlarnaPaymentsWrapper="KlarnaPaymentsWrapper"}(s.KlarnaProductNames||(s.KlarnaProductNames={}))},79:(e,s)=>{s.__esModule=!0,s.KlarnaUtf8Base64Prefix="klarna-base-64-utf8::"},714:(e,s)=>{s.__esModule=!0,s.StringifiedKlarnaInitDataSdks=[{osName:"iOS",nativeVersion:"2.0.26"},{osName:"iOS",nativeVersion:"2.0.27"},{osName:"iOS",nativeVersion:"2.0.28"},{osName:"android",nativeVersion:"2.0.26"},{osName:"android",nativeVersion:"2.0.27"},{osName:"android",nativeVersion:"2.0.28"},{osName:"android",nativeVersion:"2.0.29"}]},26:(e,s)=>{s.__esModule=!0;var a=function(e,s,a){this.bridgeVersion=e,this.endpoints={analytics:s,deviceInfo:a}};s.BridgeDataImpl=a},442:(e,s)=>{s.__esModule=!0;var a=function(e,s,a,n){this.action=e,this.receiverName=s,this.message=a,this.bridgeData=n};s.BridgeMessageImpl=a},857:(e,s)=>{s.__esModule=!0;var a=function(e,s){this.staging=e,this.production=s};s.EndpointDataImpl=a},242:(e,s)=>{s.__esModule=!0;var a=function(e,s){this.registeredNatively=!1,this.name=e,this.callback=s};s.MessageReceiverImpl=a}},s={};function a(n){var t=s[n];if(void 0!==t)return t.exports;var r=s[n]={exports:{}};return e[n](r,r.exports,a),r.exports}var n={};(()=>{n.__esModule=!0;var e=a(935);!function(){try{var s=new e.MessageBridgeImpl;if(null==window.__KlarnaNativeHook)window.__KlarnaNativeHook=s;else if(1===s.compareVersion(s.version,window.__KlarnaNativeHook.version)){var a=window.__KlarnaNativeHook,n=a.receivers,t=a.queuedMessages,r=a.eventListeners,o=a.handshakeResponseParamsMap,i=a.queuedKlarnaPaymentsMessages;if(console.log(a),s.notifyEvent({name:"WillReplaceNativeHook",payload:{oldMessageBridgeVersion:a.version,newMessageBridgeVersion:s.version,receivers:n.toString(),queuedMessages:t.toString(),nativeReady:a.nativeReady.toString()}}),window.__KlarnaNativeHook=s,s.notifyEvent({name:"ReplacedNativeHook",payload:{oldMessageBridgeVersion:a.version,newMessageBridgeVersion:s.version}}),null!=r&&r.forEach((function(e){return s.addEventListener(e)})),null!=o)if(o.forEach)o.forEach((function(e,a){s.handshakeResponseParamsMap[a]=e}));else for(var l in o)s.handshakeResponseParamsMap[l]=o[l];t.forEach((function(e){return s.queuedMessages.push(e)})),n.forEach((function(e){return s.addReceiver(e.name,e.callback)})),void 0!==i&&i.forEach((function(e){return s.queuedKlarnaPaymentsMessages.push(e)})),a.nativeReady&&window.__KlarnaNativeHook.setNativeReady(),void 0!==a.klarnaPaymentsReady&&a.klarnaPaymentsReady&&window.__KlarnaNativeHook.setKlarnaPaymentsReady()}}catch(e){console.error("__KlarnaNativeHook MessageBridge initialization failed.",e)}}()})();for(var t in n)this[t]=n[t];n.__esModule&&Object.defineProperty(this,"__esModule",{value:!0})})();
//# sourceMappingURL=app.min.js.map