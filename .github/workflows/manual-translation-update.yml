name: 'Manual Translation Update'
description: 'Manually update translations from Phrase.com and create a PR'

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'Branch to update'
        required: true
        default: 'master'

jobs:
  update-translations:
    runs-on: ubuntu-latest

    steps:
      - name: Check out repo
        uses: actions/checkout@a5ac7e51b41094c92402da3b24376905380afc29
        with:
          fetch-depth: 0
          token: ${{ secrets.RELEASE_ACCESS_KEY }}

      - name: Install Phrase CLI
        uses: phrase/setup-cli@d1c415d0ff01efc1bb21287d60a547669d9331c5
        with:
          version: '2.19.0'

      - name: Authenticate Phrase CLI
        run: phrase auth login --access-token ${{ secrets.PHRASE_ACCESS_KEY }}

      - name: Download Translations from Phrase
        run: phrase pull --project-id ${{ secrets.PHRASE_PROJECT_ID }} --branch ${{ github.event.inputs.branch }}

      - name: Commit and Push Changes
        run: |
          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          git checkout -b update-translations/${{ github.event.inputs.branch }}
          git add .
          git commit -m "Update translations"
          git push origin update-translations/${{ github.event.inputs.branch }}

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@6d6857d36972b65feb161a90e484f2984215f83e 
        with:
          token: ${{ secrets.RELEASE_ACCESS_TOKEN }}
          base: ${{ github.event.inputs.branch }}
          branch: update-translations/${{ github.event.inputs.branch }}
          title: "chore: Translation Update"
          body: "This PR updates the translations from Phrase.com."
